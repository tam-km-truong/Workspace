# Snakefile

INPUT_FOLDER = "experiments/012_IMPORTANT_snakemake_workflow/input"
OUTPUT_FOLDER = "experiments/012_IMPORTANT_snakemake_workflow/output"
TMP_FOLDER = "experiments/012_IMPORTANT_snakemake_workflow/tmp"
GENOME_FOLDER = '/Users/ktruong/data/661k/gziped_full/'
SKETCH_FOLDER = "/Users/ktruong/data/661k/hll_sketches_661k"

rule all:
    input:
        TMP_FOLDER + "/genome_files_full_path/",
        TMP_FOLDER + "/genome_sketches_full_path/",
        TMP_FOLDER + "/trees/",
        TMP_FOLDER + "/genome_files_reordered/",
        OUTPUT_FOLDER + "/batches_cardinality.csv",
        OUTPUT_FOLDER + "/genome_files_to_compress/"

rule find_genome_paths:
    input:
        INPUT_FOLDER + "/"
    output:
        directory(TMP_FOLDER + "/genome_files_full_path/")
    shell:
        """
        python python_scripts/find_genome_paths.py {input} {GENOME_FOLDER} {output}
        """

rule find_sketch_paths:
    input:
        INPUT_FOLDER + "/"
    output:
        directory(TMP_FOLDER + "/genome_sketches_full_path/")
    shell:
        """
        python python_scripts/find_genome_paths.py {input} {SKETCH_FOLDER} {output}
        """

rule bin_to_tree:
    input:
        TMP_FOLDER + "/genome_files_full_path/"
    output:
        directory(TMP_FOLDER + "/trees/")
    shell:
        """
        bash bash_scripts/bin_to_tree.sh {input} {output}
        """

rule tree_phylo_order:
    input:
        TMP_FOLDER + "/trees/"
    output:
        directory(TMP_FOLDER + "/genome_files_reordered/")
    shell:
        """
        bash bash_scripts/tree_phylo_order.sh {input} {output}
        """

rule calculate_batches_card:
    input:
        TMP_FOLDER + "/genome_sketches_full_path/"
    output:
        OUTPUT_FOLDER + "/batches_cardinality.csv"
    shell:
        """
        python python_scripts/calculate_batches_card.py {input} {output}
        """

rule find_genome_paths_reordered:
    input:
        TMP_FOLDER + "/genome_files_reordered/"
    output:
        directory(OUTPUT_FOLDER + "/genome_files_to_compress/")
    shell:
        """
        python python_scripts/find_genome_paths.py {input} {GENOME_FOLDER} {output}
        """
